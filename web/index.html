<!doctype html>
<html lang="zh-CN" class="h-full">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ChatRoom - 现代即时通讯</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: { 50:'#eff6ff',100:'#dbeafe',200:'#bfdbfe',300:'#93c5fd',400:'#60a5fa',500:'#3b82f6',600:'#2563eb',700:'#1d4ed8',800:'#1e40af',900:'#1e3a8a' },
            dark: { 700:'#334155',800:'#1e293b',900:'#0f172a',950:'#020617' }
          },
          animation: { 'slide-up':'slide-up 0.3s ease-out','scale-in':'scale-in 0.2s ease-out','typing':'typing 1.4s ease-in-out infinite' },
          keyframes: {
            'slide-up': { '0%':{transform:'translateY(10px)',opacity:'0'},'100%':{transform:'translateY(0)',opacity:'1'} },
            'scale-in': { '0%':{transform:'scale(0.95)',opacity:'0'},'100%':{transform:'scale(1)',opacity:'1'} },
            'typing': { '0%':{opacity:'0.3'},'50%':{opacity:'1'},'100%':{opacity:'0.3'} }
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="./styles.css">
</head>
<body class="h-full bg-dark-950 text-gray-100 overflow-hidden">

  <!-- Toast Container -->
  <div id="toast-container" class="fixed top-4 right-4 z-[100] space-y-2 pointer-events-none"></div>

  <!-- Auth Screen -->
  <div id="auth-screen" class="h-full flex items-center justify-center p-4 hidden">
    <!-- Animated background blobs -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute -top-40 -right-40 w-80 h-80 bg-primary-500/10 rounded-full blur-3xl"></div>
      <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-purple-500/10 rounded-full blur-3xl"></div>
    </div>
    
    <div class="relative glass glass-dark p-8 rounded-2xl shadow-2xl w-full max-w-md border border-dark-700/50 animate-scale-in">
      <!-- Logo -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-primary-500 to-primary-700 shadow-lg shadow-primary-500/25 mb-4">
          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
          </svg>
        </div>
        <h1 class="text-3xl font-bold gradient-text">ChatRoom</h1>
        <p class="text-gray-500 mt-2 text-sm">新一代实时通讯体验</p>
      </div>

      <!-- Auth Tabs -->
      <div class="flex mb-6 p-1 bg-dark-800/50 rounded-xl">
        <button id="tab-login" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all bg-primary-600 text-white">登录</button>
        <button id="tab-register" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all text-gray-400 hover:text-white">注册</button>
      </div>

      <!-- Login Form -->
      <div id="form-login" class="space-y-4">
        <div class="space-y-2">
          <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider">用户名</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            </span>
            <input id="login-username" class="w-full bg-dark-800/50 border border-dark-700 rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary-500 input-glow transition-all" placeholder="输入用户名">
          </div>
        </div>
        <div class="space-y-2">
          <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider">密码</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            </span>
            <input id="login-password" type="password" class="w-full bg-dark-800/50 border border-dark-700 rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary-500 input-glow transition-all" placeholder="输入密码">
          </div>
        </div>
        <button id="btn-login" class="w-full bg-gradient-to-r from-primary-600 to-primary-500 hover:from-primary-500 hover:to-primary-400 text-white font-semibold py-3 px-4 rounded-xl transition-all btn-shine shadow-lg shadow-primary-500/25 hover:shadow-primary-500/40 hover:-translate-y-0.5 active:translate-y-0">
          <span class="flex items-center justify-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/></svg>
            登录
          </span>
        </button>
      </div>

      <!-- Register Form (Hidden) -->
      <div id="form-register" class="space-y-4 hidden">
        <div class="space-y-2">
          <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider">用户名</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
            </span>
            <input id="reg-username" class="w-full bg-dark-800/50 border border-dark-700 rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary-500 input-glow transition-all" placeholder="创建用户名">
          </div>
        </div>
        <div class="space-y-2">
          <label class="block text-xs font-medium text-gray-400 uppercase tracking-wider">密码</label>
          <div class="relative">
            <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
            </span>
            <input id="reg-password" type="password" class="w-full bg-dark-800/50 border border-dark-700 rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary-500 input-glow transition-all" placeholder="创建密码">
          </div>
        </div>
        <button id="btn-register" class="w-full bg-gradient-to-r from-emerald-600 to-emerald-500 hover:from-emerald-500 hover:to-emerald-400 text-white font-semibold py-3 px-4 rounded-xl transition-all btn-shine shadow-lg shadow-emerald-500/25">
          <span class="flex items-center justify-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
            创建账号
          </span>
        </button>
      </div>

      <p class="mt-6 text-center text-xs text-gray-600">安全加密 · 实时同步 · 多端支持</p>
    </div>
  </div>

  <!-- App Screen -->
  <div id="app-screen" class="h-full flex hidden">
    <!-- Sidebar -->
    <div class="w-80 bg-dark-900/95 glass border-r border-dark-800 flex flex-col">
      <!-- User Profile Header -->
      <div class="p-4 border-b border-dark-800">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <div class="relative">
              <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-primary-500 to-primary-700 flex items-center justify-center text-white font-semibold text-sm shadow-lg avatar-ring">
                <span id="current-username-avatar">ME</span>
              </div>
              <span class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-emerald-500 border-2 border-dark-900 rounded-full status-online"></span>
            </div>
            <div>
              <p id="current-username" class="font-semibold text-sm">User</p>
              <p class="text-xs text-gray-500">在线</p>
            </div>
          </div>
          <button id="btn-logout" class="p-2 text-gray-400 hover:text-white hover:bg-dark-800 rounded-lg transition-colors" title="退出">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
          </button>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="p-4 border-b border-dark-800">
        <div class="relative">
          <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
          </span>
          <input id="search-rooms" class="w-full bg-dark-800/50 border border-dark-700 rounded-xl pl-10 pr-4 py-2.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-primary-500 transition-all" placeholder="搜索房间或消息...">
        </div>
      </div>

      <!-- Create Room -->
      <div class="p-4 border-b border-dark-800">
        <div class="flex gap-2">
          <input id="room-name" class="flex-1 bg-dark-800/50 border border-dark-700 rounded-xl px-3 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-primary-500 transition-all" placeholder="新房间名称">
          <button id="btn-create-room" class="bg-primary-600 hover:bg-primary-500 text-white px-4 py-2 rounded-xl text-sm font-medium transition-all flex items-center gap-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
            创建
          </button>
        </div>
      </div>

      <!-- Rooms List -->
      <div class="flex-1 overflow-y-auto">
        <div class="p-3">
          <h3 class="px-2 mb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"/></svg>
            房间列表
          </h3>
          <div id="rooms-list" class="space-y-1">
            <!-- Room items will be injected here -->
          </div>
        </div>
      </div>
    </div>

    <!-- Main Chat Area -->
    <div class="flex-1 flex flex-col bg-dark-950">
      <!-- Empty State -->
      <div id="welcome-message" class="flex-1 flex items-center justify-center">
        <div class="text-center">
          <div class="w-24 h-24 mx-auto mb-6 rounded-3xl bg-gradient-to-br from-primary-500/20 to-purple-500/20 flex items-center justify-center">
            <svg class="w-12 h-12 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
          </div>
          <h2 class="text-2xl font-bold gradient-text mb-2">欢迎回来!</h2>
          <p class="text-gray-500 mb-6">选择一个房间开始聊天</p>
          <div class="flex justify-center gap-4 text-sm text-gray-600">
            <span class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg> 端到端加密</span>
            <span class="flex items-center gap-1"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg> 实时同步</span>
          </div>
        </div>
      </div>

      <!-- Chat Room (Hidden initially) -->
      <div id="chat-area" class="flex-1 flex flex-col hidden h-full">
        <!-- Header -->
        <div class="h-16 border-b border-dark-800 flex items-center px-6 bg-dark-900/80 glass justify-between">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center text-white font-bold shadow-lg">
              <span id="room-avatar">#</span>
            </div>
            <div>
              <div class="flex items-center gap-2">
                <h2 id="current-room-name" class="text-lg font-semibold">Room Name</h2>
                <span id="connection-status" class="hidden px-2 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wide bg-yellow-500/20 text-yellow-400 connection-pulse">连接中</span>
              </div>
              <div class="flex items-center gap-2 text-xs text-gray-500">
                <span id="room-online-indicator" class="w-2 h-2 bg-emerald-500 rounded-full"></span>
                <span id="room-online">0</span> 人在线
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button id="btn-search-msg" class="p-2 text-gray-400 hover:text-white hover:bg-dark-800 rounded-lg transition-colors" title="搜索消息">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
            </button>
            <button id="btn-room-info" class="p-2 text-gray-400 hover:text-white hover:bg-dark-800 rounded-lg transition-colors" title="房间信息">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
            </button>
          </div>
        </div>

        <!-- Messages -->
        <div id="messages" class="flex-1 overflow-y-auto p-6 space-y-1">
           <!-- Messages will be injected here -->
        </div>

        <!-- Typing Indicator -->
        <div class="px-6 h-6 flex items-center">
          <div id="typing" class="text-xs text-gray-500 flex items-center gap-1.5 opacity-0 transition-opacity duration-300">
            <span class="flex gap-1">
              <span class="w-1.5 h-1.5 bg-primary-400 rounded-full typing-dot"></span>
              <span class="w-1.5 h-1.5 bg-primary-400 rounded-full typing-dot"></span>
              <span class="w-1.5 h-1.5 bg-primary-400 rounded-full typing-dot"></span>
            </span>
            <span id="typing-text">有人正在输入...</span>
          </div>
        </div>

        <!-- Input Area -->
        <div class="p-4 bg-dark-900/80 glass border-t border-dark-800">
          <div class="flex items-end gap-3">
            <!-- Emoji & Attachment buttons -->
            <div class="flex gap-1">
              <button id="btn-emoji" class="p-2.5 text-gray-400 hover:text-white hover:bg-dark-800 rounded-xl transition-colors" title="表情">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </button>
              <button id="btn-attach" class="p-2.5 text-gray-400 hover:text-white hover:bg-dark-800 rounded-xl transition-colors" title="附件">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/></svg>
              </button>
            </div>
            <!-- Message Input -->
            <div class="flex-1 relative">
              <textarea id="msg-input" rows="1" class="w-full bg-dark-800/50 border border-dark-700 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-primary-500 input-glow transition-all resize-none" placeholder="输入消息... (Enter 发送, Shift+Enter 换行)" style="max-height: 120px;"></textarea>
            </div>
            <!-- Send Button -->
            <button id="btn-send" class="bg-gradient-to-r from-primary-600 to-primary-500 hover:from-primary-500 hover:to-primary-400 text-white p-3 rounded-xl font-medium transition-all btn-shine shadow-lg shadow-primary-500/25 hover:shadow-primary-500/40">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Online Users Panel (Hidden by default) -->
    <div id="online-panel" class="w-64 bg-dark-900/95 glass border-l border-dark-800 hidden flex-col">
      <div class="p-4 border-b border-dark-800">
        <h3 class="font-semibold text-sm flex items-center gap-2">
          <span class="w-2 h-2 bg-emerald-500 rounded-full status-online"></span>
          在线成员
        </h3>
      </div>
      <div id="online-users" class="flex-1 overflow-y-auto p-3 space-y-1">
        <!-- Online users will be injected here -->
      </div>
    </div>
  </div>

  <!-- Emoji Picker Modal -->
  <div id="emoji-picker" class="fixed hidden z-50">
    <div class="bg-dark-800 border border-dark-700 rounded-2xl shadow-2xl p-3 w-72">
      <div class="grid grid-cols-8 gap-1 max-h-48 overflow-y-auto">
        <!-- Emoji buttons will be injected -->
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>